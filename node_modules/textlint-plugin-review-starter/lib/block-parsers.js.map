{"version":3,"sources":["../src/block-parsers.js"],"names":["BlockParsers","table","withCaption","parseTable","footnote","parseFootnote","quote","parseQuote","list","parseCodeBlock","listnum","emlist","emlistnum","source","cmd","image","parseImage","indepimage","numberlessimage","graph","imgtable","lead","parseLead","read","note","parseShortColumn","memo","tip","info","warning","important","caution","notice","terminal","sideimage","captionIndex","blockParser","block","node","blockArg","args","caption","parseBlockArg","Syntax","Caption","chunk","lines","children","unshift","Table","slice","length","forEach","line","Array","prototype","push","apply","parseTableContent","isComment","text","match","nodes","cellRegex","exec","startColumn","index","cellContent","startsWith","substr","context","cellNode","TableCell","Footnote","footnoteParagraph","Paragraph","parseBlockWithContent","Quote","CodeBlock","value","filter","map","raw","join","Image","Lead","ShortColumn","type","flushParagraph","paragraph","argText","blockArgContext","argNode"],"mappings":"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","sourcesContent":["// LICENSE : MIT\n'use strict';\nimport { Syntax } from './mapping';\nimport { parseText, parseLine } from './inline-parsers';\nimport {\n  createNodeFromChunk, createNodeFromLinesInChunk, createCommentNodeFromLine, createInlineNode,\n  contextFromLine, contextNeedsUnescapeBrackets\n} from './parser-utils';\n\nexport const BlockParsers = {\n  table: withCaption(1, parseTable),\n  footnote: parseFootnote,\n  quote: parseQuote,\n\n  list: withCaption(1, parseCodeBlock),\n  listnum: withCaption(1, parseCodeBlock),\n  emlist: withCaption(0, parseCodeBlock),\n  emlistnum: withCaption(0, parseCodeBlock),\n  source: parseCodeBlock,\n  cmd: parseCodeBlock,\n\n  image: withCaption(1, parseImage),\n  indepimage: withCaption(1, parseImage),\n  numberlessimage: withCaption(1, parseImage),\n  graph: withCaption(2, parseImage),\n  imgtable: withCaption(1, parseImage),\n\n  lead: parseLead,\n  read: parseLead,\n\n  note: withCaption(0, parseShortColumn),\n  memo: withCaption(0, parseShortColumn),\n  tip: withCaption(0, parseShortColumn),\n  info: withCaption(0, parseShortColumn),\n  warning: withCaption(0, parseShortColumn),\n  important: withCaption(0, parseShortColumn),\n  caution: withCaption(0, parseShortColumn),\n  notice: withCaption(0, parseShortColumn),\n\n  // Starter\n  abstract: parseLead,\n  terminal: parseCodeBlock,\n  sideimage: withCaption(null, parseImage),\n};\n\n/**\n * return new parser to parse block with caption.\n * @param {number} captionIndex - index of caption in block args\n * @param {function} blockParser - Parser function of a block\n * @return {function} parser function\n */\nfunction withCaption(captionIndex, blockParser) {\n  return function (block) {\n    const node = blockParser(block);\n\n    if (captionIndex !== null) {\n      const blockArg = block.args[captionIndex];\n      if (blockArg) {\n        const caption = parseBlockArg(Syntax.Caption, blockArg, block.chunk.lines[0]);\n        if (caption) {\n          node.children = node.children || [];\n          node.children.unshift(caption);\n        }\n      }\n    }\n\n    return node;\n  };\n}\n\n/**\n * parse table block.\n * @param {Block} block - Block to parse\n * @return {TxtNode} Table node\n */\nfunction parseTable(block) {\n  const node = createNodeFromChunk(block.chunk, Syntax.Table);\n  node.children = [];\n\n  block.chunk.lines.slice(1, block.chunk.lines.length - 1).forEach(line => {\n    Array.prototype.push.apply(node.children, parseTableContent(line));\n  });\n\n  return node;\n}\n\n/**\n * parse line in a table.\n * @param {Line} line - Line to parse\n * @return {[TxtNode]} ListItem nodes in the line\n */\nfunction parseTableContent(line) {\n  if (line.isComment) {\n    return [createCommentNodeFromLine(line)];\n  }\n\n  if (line.text.match(/^-+$/)) {\n    return [];  // Ignore horizontal line\n  }\n\n  const nodes = [];\n  const cellRegex = /[^\\t]+/g;\n  var match;\n  while (match = cellRegex.exec(line.text)) {\n    let startColumn = match.index;\n    let cellContent = match[0];\n    if (cellContent.startsWith('.')) {\n      cellContent = cellContent.substr(1);\n      startColumn += 1;\n    }\n\n    if (cellContent === '') {\n      continue;\n    }\n\n    const context = contextFromLine(line, startColumn);\n    const cellNode = createInlineNode(Syntax.TableCell, cellContent, context);\n    cellNode.children = parseText(cellContent, context);\n    nodes.push(cellNode);\n  }\n\n  return nodes;\n}\n\n/**\n * parse footnote block.\n * @param {Block} block - Block to parse\n * @return {TxtNode} Footnote node\n */\nfunction parseFootnote(block) {\n  const node = createNodeFromChunk(block.chunk, Syntax.Footnote);\n  const footnoteParagraph = parseBlockArg(Syntax.Paragraph, block.args[1], block.chunk.lines[0]);\n  if (footnoteParagraph) {\n    node.children = [footnoteParagraph];\n  }\n\n  return node;\n}\n\n/**\n * parse quote block.\n * @param {Block} block - Block to parse\n * @return {TxtNode} BlockQuote node\n */\nfunction parseQuote(block) {\n  return parseBlockWithContent(block, Syntax.Quote);\n}\n\n/**\n * parse code block, e.g //list, //emlist, //source etc.\n * @param {Block} block - Block to parse\n * @return {TxtNode} CodeBlock node\n */\nfunction parseCodeBlock(block) {\n  const node = createNodeFromChunk(block.chunk, Syntax.CodeBlock);\n  node.value = block.chunk.lines\n    .slice(1, block.chunk.lines.length - 1)\n    .filter(line => !line.isComment)\n    .map(line => line.raw)\n    .join('');\n  return node;\n}\n\n/**\n * parse image block.\n * @param {Block} block - Block to parse\n * @return {TxtNode} Image node\n */\nfunction parseImage(block) {\n  return createNodeFromChunk(block.chunk, Syntax.Image);\n}\n\n/**\n * parse lead block.\n * @param {Block} block - Block to parse\n * @return {TxtNode} Block node\n */\nfunction parseLead(block) {\n  return parseBlockWithContent(block, Syntax.Lead);\n}\n\n/**\n * parse various short column block.\n * @param {Block} block - Block to parse\n * @return {TxtNode} Block node\n */\nfunction parseShortColumn(block) {\n  return parseBlockWithContent(block, Syntax.ShortColumn);\n}\n\n/**\n * parse a block with content. which is parsed as paragraphs.\n * @param {Block} block - line to parse\n * @param {string} type - Type of node\n * @return {[TxtNode]} TxtNode\n */\nexport function parseBlockWithContent(block, type) {\n  const chunk = block.chunk;\n  const node = createNodeFromChunk(chunk, type);\n  node.children = [];\n\n  let lines = [];\n  const flushParagraph = function () {\n    if (lines.length > 0) {\n      const paragraph = createNodeFromLinesInChunk(Syntax.Paragraph, lines, chunk);\n      paragraph.children = [];\n      lines.forEach(line => {\n        Array.prototype.push.apply(paragraph.children, parseLine(line));\n      });\n      node.children.push(paragraph);\n    }\n\n    lines = [];\n  };\n\n  chunk.lines.slice(1, chunk.lines.length - 1).forEach(line => {\n    if (line.text === '') {\n      flushParagraph();\n    } else {\n      lines.push(line);\n    }\n  });\n\n  flushParagraph();\n\n  return node;\n}\n\n/**\n * parse single argument of a block as a TxtNode\n * @param {string} type - Type of node\n * @param {Arg} blockArg - Arg of a block to parse\n * @param {Line} line - line where Arg exists\n * @return {TxtNode}\n */\nexport function parseBlockArg(type, blockArg, line) {\n  const argText = blockArg.value;\n  if (!argText) {\n    return null;\n  }\n\n  const startColumn = blockArg.startColumn;\n  const blockArgContext = contextNeedsUnescapeBrackets(contextFromLine(line, startColumn));\n  const argNode = createInlineNode(type, argText, blockArgContext);\n  argNode.children = parseText(argText, blockArgContext);\n  return argNode;\n}\n\n"],"file":"block-parsers.js"}