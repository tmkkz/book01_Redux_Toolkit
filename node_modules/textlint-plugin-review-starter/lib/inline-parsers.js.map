{"version":3,"sources":["../src/inline-parsers.js"],"names":["parseLine","line","isComment","parseText","text","InlineParsers","bou","inlineTextTagParser","Syntax","Bouten","ami","Amikake","u","Underline","b","Bold","i","Italic","strong","Strong","em","Emphasis","tt","Teletype","tti","TeletypeItalic","ttb","TeletypeBold","tcy","TateChuYoko","kw","parseKeywordTag","ruby","parseRubyTag","href","parseHrefTag","chap","inlineNonTextTagParser","Reference","title","chapref","list","img","table","hd","column","fn","code","withValue","Code","comment","Comment","uchar","UnicodeChar","br","Break","icon","Icon","m","Math","raw","Raw","B","weak","Weak","small","Small","xsmall","XSmall","xxsmall","XXSmall","large","Large","xlarge","XLarge","xxlarge","XXLarge","userinput","UserInput","cursor","Cursor","secref","file","hlink","LaTex","inlineSymbolTagParser","Tex","hearts","inlineParser","tag","context","node","value","content","type","parseInlineNonTextTag","parseInlineTextTag","fullText","parseSymbolTag","strContext","index","strNode","children","Keyword","pieces","split","word","length","alt","Href","url","label","labelOffset","indexOf","Ruby","rubyBase","rubyText","Symbol","match","parseNestedText","depth","nodes","precedingText","push","parser","name","nestedContext","Object","assign","startIndex","nestedNodes","followingText"],"mappings":"AAAA;AACA;;;;;;;;;AACA;;AACA;;AACA;;;;;;;AAKA;;;;;AAKO,SAASA,SAAT,CAAmBC,IAAnB,EAAyB;AAC9B,MAAIA,IAAI,CAACC,SAAT,EAAoB;AAClB,WAAO,CAAC,4CAA0BD,IAA1B,CAAD,CAAP;AACD;;AAED,SAAOE,SAAS,CAACF,IAAI,CAACG,IAAN,EAAY,kCAAgBH,IAAhB,CAAZ,CAAhB;AACD;;AAED,IAAMI,aAAa,GAAG;AACpB;AACAC,EAAAA,GAAG,EAAMC,mBAAmB,CAACC,gBAAOC,MAAR,CAFR;AAGpBC,EAAAA,GAAG,EAAMH,mBAAmB,CAACC,gBAAOG,OAAR,CAHR;AAIpBC,EAAAA,CAAC,EAAQL,mBAAmB,CAACC,gBAAOK,SAAR,CAJR;AAKpBC,EAAAA,CAAC,EAAQP,mBAAmB,CAACC,gBAAOO,IAAR,CALR;AAMpBC,EAAAA,CAAC,EAAQT,mBAAmB,CAACC,gBAAOS,MAAR,CANR;AAOpBC,EAAAA,MAAM,EAAGX,mBAAmB,CAACC,gBAAOW,MAAR,CAPR;AAQpBC,EAAAA,EAAE,EAAOb,mBAAmB,CAACC,gBAAOa,QAAR,CARR;AASpBC,EAAAA,EAAE,EAAOf,mBAAmB,CAACC,gBAAOe,QAAR,CATR;AAUpBC,EAAAA,GAAG,EAAMjB,mBAAmB,CAACC,gBAAOiB,cAAR,CAVR;AAWpBC,EAAAA,GAAG,EAAMnB,mBAAmB,CAACC,gBAAOmB,YAAR,CAXR;AAYpBC,EAAAA,GAAG,EAAMrB,mBAAmB,CAACC,gBAAOqB,WAAR,CAZR;AAcpB;AACAC,EAAAA,EAAE,EAAOC,eAfW;AAgBpBC,EAAAA,IAAI,EAAKC,YAhBW;AAiBpBC,EAAAA,IAAI,EAAKC,YAjBW;AAmBpB;AACAC,EAAAA,IAAI,EAAKC,sBAAsB,CAAC7B,gBAAO8B,SAAR,CApBX;AAqBpBC,EAAAA,KAAK,EAAIF,sBAAsB,CAAC7B,gBAAO8B,SAAR,CArBX;AAsBpBE,EAAAA,OAAO,EAAEH,sBAAsB,CAAC7B,gBAAO8B,SAAR,CAtBX;AAuBpBG,EAAAA,IAAI,EAAKJ,sBAAsB,CAAC7B,gBAAO8B,SAAR,CAvBX;AAwBpBI,EAAAA,GAAG,EAAML,sBAAsB,CAAC7B,gBAAO8B,SAAR,CAxBX;AAyBpBK,EAAAA,KAAK,EAAIN,sBAAsB,CAAC7B,gBAAO8B,SAAR,CAzBX;AA0BpBM,EAAAA,EAAE,EAAOP,sBAAsB,CAAC7B,gBAAO8B,SAAR,CA1BX;AA2BpBO,EAAAA,MAAM,EAAGR,sBAAsB,CAAC7B,gBAAO8B,SAAR,CA3BX;AA4BpBQ,EAAAA,EAAE,EAAOT,sBAAsB,CAAC7B,gBAAO8B,SAAR,CA5BX;AA8BpBS,EAAAA,IAAI,EAAKC,SAAS,CAACX,sBAAsB,CAAC7B,gBAAOyC,IAAR,CAAvB,CA9BE;AA+BpBC,EAAAA,OAAO,EAAEF,SAAS,CAACX,sBAAsB,CAAC7B,gBAAO2C,OAAR,CAAvB,CA/BE;AAgCpBC,EAAAA,KAAK,EAAIf,sBAAsB,CAAC7B,gBAAO6C,WAAR,CAhCX;AAiCpBC,EAAAA,EAAE,EAAOjB,sBAAsB,CAAC7B,gBAAO+C,KAAR,CAjCX;AAkCpBC,EAAAA,IAAI,EAAKnB,sBAAsB,CAAC7B,gBAAOiD,IAAR,CAlCX;AAmCpBC,EAAAA,CAAC,EAAQrB,sBAAsB,CAAC7B,gBAAOmD,IAAR,CAnCX;AAoCpBC,EAAAA,GAAG,EAAMvB,sBAAsB,CAAC7B,gBAAOqD,GAAR,CApCX;AAsCpB;AACAC,EAAAA,CAAC,EAAUvD,mBAAmB,CAACC,gBAAOW,MAAR,CAvCV;AAwCpB4C,EAAAA,IAAI,EAAOxD,mBAAmB,CAACC,gBAAOwD,IAAR,CAxCV;AAyCpBC,EAAAA,KAAK,EAAM1D,mBAAmB,CAACC,gBAAO0D,KAAR,CAzCV;AA0CpBC,EAAAA,MAAM,EAAK5D,mBAAmB,CAACC,gBAAO4D,MAAR,CA1CV;AA2CpBC,EAAAA,OAAO,EAAI9D,mBAAmB,CAACC,gBAAO8D,OAAR,CA3CV;AA4CpBC,EAAAA,KAAK,EAAMhE,mBAAmB,CAACC,gBAAOgE,KAAR,CA5CV;AA6CpBC,EAAAA,MAAM,EAAKlE,mBAAmB,CAACC,gBAAOkE,MAAR,CA7CV;AA8CpBC,EAAAA,OAAO,EAAIpE,mBAAmB,CAACC,gBAAOoE,OAAR,CA9CV;AA+CpBC,EAAAA,SAAS,EAAEtE,mBAAmB,CAACC,gBAAOsE,SAAR,CA/CV;AAgDpBC,EAAAA,MAAM,EAAKxE,mBAAmB,CAACC,gBAAOwE,MAAR,CAhDV;AAiDpBC,EAAAA,MAAM,EAAK5C,sBAAsB,CAAC7B,gBAAO8B,SAAR,CAjDb;AAkDpB4C,EAAAA,IAAI,EAAOnD,eAlDS;AAmDpBoD,EAAAA,KAAK,EAAMhD,YAnDS;AAoDpBiD,EAAAA,KAAK,EAAMC,qBAAqB,CAAC,OAAD,CApDZ;AAqDpBC,EAAAA,GAAG,EAAQD,qBAAqB,CAAC,KAAD,CArDZ;AAsDpBE,EAAAA,MAAM,EAAKF,qBAAqB,CAAC,GAAD;AAtDZ,CAAtB;AAyDA;;;;;;AAKA,SAASrC,SAAT,CAAmBwC,YAAnB,EAAiC;AAC/B,SAAO,UAACC,GAAD,EAAMC,OAAN,EAAkB;AACvB,QAAMC,IAAI,GAAGH,YAAY,CAACC,GAAD,EAAMC,OAAN,CAAzB;AACAC,IAAAA,IAAI,CAACC,KAAL,GAAa,gCAAcH,GAAG,CAACI,OAAJ,CAAYjC,GAA1B,EAA+B8B,OAA/B,CAAb;AACA,WAAOC,IAAP;AACD,GAJD;AAKD;AAED;;;;;;;AAKA,SAAStD,sBAAT,CAAgCyD,IAAhC,EAAsC;AACpC,SAAO,UAACL,GAAD,EAAMC,OAAN;AAAA,WACLK,qBAAqB,CAACD,IAAD,EAAOL,GAAP,EAAYC,OAAZ,CADhB;AAAA,GAAP;AAED;AAED;;;;;;;AAKA,SAASnF,mBAAT,CAA6BuF,IAA7B,EAAmC;AACjC,SAAO,UAACL,GAAD,EAAMC,OAAN;AAAA,WACLM,kBAAkB,CAACF,IAAD,EAAOL,GAAP,EAAYC,OAAZ,CADb;AAAA,GAAP;AAED;AAED;;;;;;;;;AAOA,SAASK,qBAAT,CAA+BD,IAA/B,EAAqCL,GAArC,EAA0CC,OAA1C,EAAmD;AACjD,MAAMC,IAAI,GAAG,mCAAiBG,IAAjB,EAAuBL,GAAG,CAACQ,QAA3B,EAAqCP,OAArC,CAAb;AACA,SAAOC,IAAP;AACD;AAED;;;;;;;AAKA,SAASN,qBAAT,CAA+BjF,IAA/B,EAAqC;AACnC,SAAO,UAACqF,GAAD,EAAMC,OAAN;AAAA,WACLQ,cAAc,CAAC9F,IAAD,EAAOqF,GAAP,EAAYC,OAAZ,CADT;AAAA,GAAP;AAED;AAED;;;;;;;;;AAOA,SAASM,kBAAT,CAA4BF,IAA5B,EAAkCL,GAAlC,EAAuCC,OAAvC,EAAgD;AAC9C,MAAMC,IAAI,GAAG,mCAAiBG,IAAjB,EAAuBL,GAAG,CAACQ,QAA3B,EAAqCP,OAArC,CAAb;AACA,MAAMS,UAAU,GAAG,gCAAcT,OAAd,EAAuBD,GAAG,CAACI,OAAJ,CAAYO,KAAnC,CAAnB;AACA,MAAMC,OAAO,GAAG,gCAAcZ,GAAG,CAACI,OAAJ,CAAYjC,GAA1B,EAA+BuC,UAA/B,CAAhB;AACAR,EAAAA,IAAI,CAACW,QAAL,GAAgB,CAACD,OAAD,CAAhB;AACA,SAAOV,IAAP;AACD;AAED;;;;;;;;AAMA,SAAS5D,eAAT,CAAyB0D,GAAzB,EAA8BC,OAA9B,EAAuC;AACrC,MAAMC,IAAI,GAAG,mCAAiBnF,gBAAO+F,OAAxB,EAAiCd,GAAG,CAACQ,QAArC,EAA+CP,OAA/C,CAAb;AAEA,MAAMc,MAAM,GAAGf,GAAG,CAACI,OAAJ,CAAYjC,GAAZ,CAAgB6C,KAAhB,CAAsB,SAAtB,EAAiC,CAAjC,CAAf;AACA,MAAMC,IAAI,GAAGF,MAAM,CAAC,CAAD,CAAnB;;AACA,MAAIA,MAAM,CAACG,MAAP,KAAkB,CAAtB,EAAyB;AACvBhB,IAAAA,IAAI,CAACiB,GAAL,GAAWJ,MAAM,CAAC,CAAD,CAAjB;AACD;;AAED,MAAMH,OAAO,GAAG,gCAAcK,IAAd,EAAoB,gCAAchB,OAAd,EAAuBD,GAAG,CAACI,OAAJ,CAAYO,KAAnC,CAApB,CAAhB;AACAT,EAAAA,IAAI,CAACW,QAAL,GAAgB,CAACD,OAAD,CAAhB;AAEA,SAAOV,IAAP;AACD;AAED;;;;;;;;AAMA,SAASxD,YAAT,CAAsBsD,GAAtB,EAA2BC,OAA3B,EAAoC;AAClC,MAAMC,IAAI,GAAG,mCAAiBnF,gBAAOqG,IAAxB,EAA8BpB,GAAG,CAACQ,QAAlC,EAA4CP,OAA5C,CAAb;AAEA,MAAMc,MAAM,GAAGf,GAAG,CAACI,OAAJ,CAAYjC,GAAZ,CAAgB6C,KAAhB,CAAsB,SAAtB,EAAiC,CAAjC,CAAf;AACA,MAAMK,GAAG,GAAGN,MAAM,CAAC,CAAD,CAAlB;AACA,MAAIO,KAAJ;AACA,MAAIC,WAAJ;;AACA,MAAIR,MAAM,CAACG,MAAP,KAAkB,CAAtB,EAAyB;AAAA;;AACvBI,IAAAA,KAAK,GAAGP,MAAM,CAAC,CAAD,CAAd;AACAQ,IAAAA,WAAW,GAAGvB,GAAG,CAACI,OAAJ,CAAYO,KAAZ,GAAoBX,GAAG,CAACI,OAAJ,CAAYjC,GAAZ,CAAgBqD,OAAhB,CAAwBF,KAAxB,EAA+BD,GAAG,CAACH,MAAnC,CAAlC;AACA,kDAAO,WAAAK,WAAW,qBAAX,eAAe,sBAAAvB,GAAG,oCAAH,CAAII,OAAJ,8BAAYO,KAA3B,sBAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACD,GAJD,MAIO;AACLW,IAAAA,KAAK,GAAGD,GAAR;AACAE,IAAAA,WAAW,GAAGvB,GAAG,CAACI,OAAJ,CAAYO,KAA1B;AACD;;AAED,MAAMD,UAAU,GAAG,gCAAcT,OAAd,EAAuBsB,WAAvB,CAAnB;AACA,MAAMX,OAAO,GAAG,gCAAcU,KAAd,EAAqBZ,UAArB,CAAhB;AAEAR,EAAAA,IAAI,CAACmB,GAAL,GAAWA,GAAX;AACAnB,EAAAA,IAAI,CAACW,QAAL,GAAgB,CAACD,OAAD,CAAhB;AAEA,SAAOV,IAAP;AACD;AAED;;;;;;;;AAMA,SAAS1D,YAAT,CAAsBwD,GAAtB,EAA2BC,OAA3B,EAAoC;AAAA;;AAClC,MAAMC,IAAI,GAAG,mCAAiBnF,gBAAO0G,IAAxB,EAA8BzB,GAAG,CAACQ,QAAlC,EAA4CP,OAA5C,CAAb;AACA,MAAMc,MAAM,GAAGf,GAAG,CAACI,OAAJ,CAAYjC,GAAZ,CAAgB6C,KAAhB,CAAsB,SAAtB,EAAiC,CAAjC,CAAf;AACA,kDAAO,wBAAAD,MAAM,4BAAN,CAAOG,MAAP,0BAAkB,CAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,MAAMQ,QAAQ,GAAGX,MAAM,CAAC,CAAD,CAAvB;AACA,MAAMY,QAAQ,GAAGZ,MAAM,CAAC,CAAD,CAAvB;AAEA,MAAMH,OAAO,GAAG,gCAAcc,QAAd,EAAwB,gCAAczB,OAAd,EAAuBD,GAAG,CAACI,OAAJ,CAAYO,KAAnC,CAAxB,CAAhB;AAEAT,EAAAA,IAAI,CAACyB,QAAL,GAAgBA,QAAhB;AACAzB,EAAAA,IAAI,CAACW,QAAL,GAAgB,CAACD,OAAD,CAAhB;AAEA,SAAOV,IAAP;AACD;AAED;;;;;;;;;AAOA,SAASO,cAAT,CAAwB9F,IAAxB,EAA8BqF,GAA9B,EAAmCC,OAAnC,EAA4C;AAC1C,MAAMC,IAAI,GAAG,mCAAiBnF,gBAAO6G,MAAxB,EAAgC5B,GAAG,CAACQ,QAApC,EAA8CP,OAA9C,CAAb;AACAC,EAAAA,IAAI,CAACC,KAAL,GAAaxF,IAAb;AACA,SAAOuF,IAAP;AACD;AAED;;;;;;;;AAMO,SAASxF,SAAT,CAAmBC,IAAnB,EAAyBsF,OAAzB,EAAkC;AAAA;;AACvC,kDAAO,aAAC,YAAAtF,IAAI,uCAAJ,CAAKkH,KAAL,CAAW,QAAX,CAAD,yBAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,SAAOC,eAAe,CAACnH,IAAD,EAAOsF,OAAP,EAAgB,CAAhB,CAAtB;AACD;;AAEM,SAAS6B,eAAT,CAAyBnH,IAAzB,EAA+BsF,OAA/B,EAAwC8B,KAAxC,EAA+C;AACpD,MAAMC,KAAK,GAAG,EAAd;AACA,MAAIhC,GAAJ;;AACA,SAAOA,GAAG,GAAG,gCAAcrF,IAAd,CAAb,EAAkC;AAChC,QAAIqF,GAAG,CAACiC,aAAJ,KAAsB,EAA1B,EAA8B;AAC5B,UAAM/B,IAAI,GAAG,gCAAcF,GAAG,CAACiC,aAAlB,EAAiChC,OAAjC,CAAb;AACA+B,MAAAA,KAAK,CAACE,IAAN,CAAWhC,IAAX;AACAD,MAAAA,OAAO,GAAG,gCAAcA,OAAd,EAAuBC,IAAI,CAAC/B,GAAL,CAAS+C,MAAhC,CAAV;AACD;;AAED,QAAMiB,MAAM,GAAGvH,aAAa,CAACoF,GAAG,CAACoC,IAAL,CAA5B;;AACA,QAAID,MAAJ,EAAY;AACV,UAAIE,aAAa,GAAGC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBtC,OAAlB,CAApB;AACAoC,MAAAA,aAAa,GAAG,gCAAcA,aAAd,EAA6BrC,GAAG,CAACI,OAAJ,CAAYoC,UAAzC,CAAhB;AACA,UAAMC,WAAW,GAAGX,eAAe,CAAC9B,GAAG,CAACI,OAAJ,CAAYjC,GAAb,EAAkBkE,aAAlB,EAAiCN,KAAK,GAAG,CAAzC,CAAnC;;AACA,UAAM7B,KAAI,GAAGiC,MAAM,CAACnC,GAAD,EAAM,6CAA2BC,OAA3B,CAAN,CAAnB;;AACA,UAAIwC,WAAJ,EAAkB;AAChBvC,QAAAA,KAAI,CAACW,QAAL,GAAgB4B,WAAhB;AACD;;AACDT,MAAAA,KAAK,CAACE,IAAN,CAAWhC,KAAX;AACD;;AACDD,IAAAA,OAAO,GAAG,gCAAcA,OAAd,EAAuBD,GAAG,CAACQ,QAAJ,CAAaU,MAApC,CAAV;AACAvG,IAAAA,IAAI,GAAGqF,GAAG,CAAC0C,aAAX;AACD;;AAED,MAAIX,KAAK,GAAG,CAAR,IAAa,CAACC,KAAK,CAACd,MAAxB,EAAgC;AAC9B,WAAO,IAAP;AACD;;AAED,MAAIvG,IAAI,CAACuG,MAAT,EAAiB;AACf,QAAMhB,MAAI,GAAG,gCAAcvF,IAAd,EAAoBsF,OAApB,CAAb;;AACA+B,IAAAA,KAAK,CAACE,IAAN,CAAWhC,MAAX;AACD;;AAED,SAAO8B,KAAP;AACD","sourcesContent":["// LICENSE : MIT\n'use strict';\nimport assert from 'assert';\nimport { Syntax } from './mapping';\nimport {\n  parseBlockArg, findInlineTag, createNodeFromChunk, createCommentNodeFromLine, createStrNode,\n  createInlineNode, contextFromLine, offsetContext, contextNeedsUnescapeBraces, unescapeValue\n} from './parser-utils';\n\n/**\n * parse a line.\n * @param {Line} line - line to parse\n * @return {[TxtNode]} TxtNodes\n */\nexport function parseLine(line) {\n  if (line.isComment) {\n    return [createCommentNodeFromLine(line)];\n  }\n\n  return parseText(line.text, contextFromLine(line));\n}\n\nconst InlineParsers = {\n  // text tags\n  bou:     inlineTextTagParser(Syntax.Bouten),\n  ami:     inlineTextTagParser(Syntax.Amikake),\n  u:       inlineTextTagParser(Syntax.Underline),\n  b:       inlineTextTagParser(Syntax.Bold),\n  i:       inlineTextTagParser(Syntax.Italic),\n  strong:  inlineTextTagParser(Syntax.Strong),\n  em:      inlineTextTagParser(Syntax.Emphasis),\n  tt:      inlineTextTagParser(Syntax.Teletype),\n  tti:     inlineTextTagParser(Syntax.TeletypeItalic),\n  ttb:     inlineTextTagParser(Syntax.TeletypeBold),\n  tcy:     inlineTextTagParser(Syntax.TateChuYoko),\n\n  // partially text tags\n  kw:      parseKeywordTag,\n  ruby:    parseRubyTag,\n  href:    parseHrefTag,\n\n  // non-text tags\n  chap:    inlineNonTextTagParser(Syntax.Reference),\n  title:   inlineNonTextTagParser(Syntax.Reference),\n  chapref: inlineNonTextTagParser(Syntax.Reference),\n  list:    inlineNonTextTagParser(Syntax.Reference),\n  img:     inlineNonTextTagParser(Syntax.Reference),\n  table:   inlineNonTextTagParser(Syntax.Reference),\n  hd:      inlineNonTextTagParser(Syntax.Reference),\n  column:  inlineNonTextTagParser(Syntax.Reference),\n  fn:      inlineNonTextTagParser(Syntax.Reference),\n\n  code:    withValue(inlineNonTextTagParser(Syntax.Code)),\n  comment: withValue(inlineNonTextTagParser(Syntax.Comment)),\n  uchar:   inlineNonTextTagParser(Syntax.UnicodeChar),\n  br:      inlineNonTextTagParser(Syntax.Break),\n  icon:    inlineNonTextTagParser(Syntax.Icon),\n  m:       inlineNonTextTagParser(Syntax.Math),\n  raw:     inlineNonTextTagParser(Syntax.Raw),\n\n  // Starter\n  B:         inlineTextTagParser(Syntax.Strong),\n  weak:      inlineTextTagParser(Syntax.Weak),\n  small:     inlineTextTagParser(Syntax.Small),\n  xsmall:    inlineTextTagParser(Syntax.XSmall),\n  xxsmall:   inlineTextTagParser(Syntax.XXSmall),\n  large:     inlineTextTagParser(Syntax.Large),\n  xlarge:    inlineTextTagParser(Syntax.XLarge),\n  xxlarge:   inlineTextTagParser(Syntax.XXLarge),\n  userinput: inlineTextTagParser(Syntax.UserInput),\n  cursor:    inlineTextTagParser(Syntax.Cursor),\n  secref:    inlineNonTextTagParser(Syntax.Reference),\n  file:      parseKeywordTag,\n  hlink:     parseHrefTag,\n  LaTex:     inlineSymbolTagParser('LaTex'),\n  Tex:       inlineSymbolTagParser('Tex'),\n  hearts:    inlineSymbolTagParser('❤'),\n};\n\n/**\n * get new inline tag parser to get value attribute.\n * @param {function} inlineParser - Parser function of a inline tag\n * @return {function} parser function\n */\nfunction withValue(inlineParser) {\n  return (tag, context) => {\n    const node = inlineParser(tag, context);\n    node.value = unescapeValue(tag.content.raw, context);\n    return node;\n  };\n}\n\n/**\n * get non-text tag parser function.\n * @param {string} type - type of tag\n * @return {function} parser function\n */\nfunction inlineNonTextTagParser(type) {\n  return (tag, context) =>\n    parseInlineNonTextTag(type, tag, context);\n}\n\n/**\n * get text tag parser function.\n * @param {string} type - type of tag\n * @return {function} parser function\n */\nfunction inlineTextTagParser(type) {\n  return (tag, context) =>\n    parseInlineTextTag(type, tag, context);\n}\n\n/**\n * parse non-text tag, which has no child.\n * @param {string} type - type of tag\n * @param {Tag} tag - tag to parse\n * @param {Context} context - context of the node\n * @return {TxtNode}\n */\nfunction parseInlineNonTextTag(type, tag, context) {\n  const node = createInlineNode(type, tag.fullText, context);\n  return node;\n}\n\n/**\n * get text tag parser function.\n * @param {string} type - type of tag\n * @return {function} parser function\n */\nfunction inlineSymbolTagParser(text) {\n  return (tag, context) =>\n    parseSymbolTag(text, tag, context);\n}\n\n/**\n * parse text tag, which has child Str node.\n * @param {string} type - type of tag\n * @param {Tag} tag - tag to parse\n * @param {Context} context - context of the node\n * @return {TxtNode}\n */\nfunction parseInlineTextTag(type, tag, context) {\n  const node = createInlineNode(type, tag.fullText, context);\n  const strContext = offsetContext(context, tag.content.index);\n  const strNode = createStrNode(tag.content.raw, strContext);\n  node.children = [strNode];\n  return node;\n}\n\n/**\n * parse @<kw>{} tag.\n * @param {Tag} tag - tag to parse\n * @param {Context} context - context of the node\n * @return {TxtNode}\n */\nfunction parseKeywordTag(tag, context) {\n  const node = createInlineNode(Syntax.Keyword, tag.fullText, context);\n\n  const pieces = tag.content.raw.split(/\\s*,\\s*/, 2);\n  const word = pieces[0];\n  if (pieces.length === 2) {\n    node.alt = pieces[1];\n  }\n\n  const strNode = createStrNode(word, offsetContext(context, tag.content.index));\n  node.children = [strNode];\n\n  return node;\n}\n\n/**\n * parse @<href>{} tag.\n * @param {Tag} tag - tag to parse\n * @param {Context} context - context of the node\n * @return {TxtNode}\n */\nfunction parseHrefTag(tag, context) {\n  const node = createInlineNode(Syntax.Href, tag.fullText, context);\n\n  const pieces = tag.content.raw.split(/\\s*,\\s*/, 2);\n  const url = pieces[0];\n  let label;\n  let labelOffset;\n  if (pieces.length === 2) {\n    label = pieces[1];\n    labelOffset = tag.content.index + tag.content.raw.indexOf(label, url.length);\n    assert(labelOffset >= tag.content.index);\n  } else {\n    label = url;\n    labelOffset = tag.content.index;\n  }\n\n  const strContext = offsetContext(context, labelOffset);\n  const strNode = createStrNode(label, strContext);\n\n  node.url = url;\n  node.children = [strNode];\n\n  return node;\n}\n\n/**\n * parse @<ruby>{} tag.\n * @param {Tag} tag - tag to parse\n * @param {Context} context - context of the node\n * @return {TxtNode}\n */\nfunction parseRubyTag(tag, context) {\n  const node = createInlineNode(Syntax.Ruby, tag.fullText, context);\n  const pieces = tag.content.raw.split(/\\s*,\\s*/, 2);\n  assert(pieces.length === 2);\n  const rubyBase = pieces[0];\n  const rubyText = pieces[1];\n\n  const strNode = createStrNode(rubyBase, offsetContext(context, tag.content.index));\n\n  node.rubyText = rubyText;\n  node.children = [strNode];\n\n  return node;\n}\n\n/**\n * parse @<LaTex>{} tag.\n * @param {string} text - symbol substitute text\n * @param {Tag} tag - tag to parse\n * @param {Context} context - context of the node\n * @return {TxtNode}\n */\nfunction parseSymbolTag(text, tag, context) {\n  const node = createInlineNode(Syntax.Symbol, tag.fullText, context);\n  node.value = text;\n  return node;\n}\n\n/**\n * parse inline tags and StrNodes from line.\n * @param {string} text - Text of the line\n * @param {Context} context - context of the node\n * @return {[TxtNode]} TxtNodes in the line\n */\nexport function parseText(text, context) {\n  assert(!text.match(/[\\r\\n]/));\n\n  return parseNestedText(text, context, 0)\n}\n\nexport function parseNestedText(text, context, depth) {\n  const nodes = [];\n  let tag;\n  while (tag = findInlineTag(text)) {\n    if (tag.precedingText !== '') {\n      const node = createStrNode(tag.precedingText, context);\n      nodes.push(node);\n      context = offsetContext(context, node.raw.length);\n    }\n\n    const parser = InlineParsers[tag.name];\n    if (parser) {\n      let nestedContext = Object.assign({}, context);\n      nestedContext = offsetContext(nestedContext, tag.content.startIndex)\n      const nestedNodes = parseNestedText(tag.content.raw, nestedContext, depth + 1)\n      const node = parser(tag, contextNeedsUnescapeBraces(context));\n      if( nestedNodes ) {\n        node.children = nestedNodes\n      }\n      nodes.push(node);\n    }\n    context = offsetContext(context, tag.fullText.length);\n    text = tag.followingText;\n  }\n\n  if (depth > 0 && !nodes.length) {\n    return null;\n  }\n\n  if (text.length) {\n    const node = createStrNode(text, context);\n    nodes.push(node);\n  }\n\n  return nodes;\n}\n\n"],"file":"inline-parsers.js"}